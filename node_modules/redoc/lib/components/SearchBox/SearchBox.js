"use strict";
var __makeTemplateObject = (this && this.__makeTemplateObject) || function (cooked, raw) {
    if (Object.defineProperty) { Object.defineProperty(cooked, "raw", { value: raw }); } else { cooked.raw = raw; }
    return cooked;
};
var __extends = (this && this.__extends) || (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
var React = require("react");
var styled_components_1 = require("../../styled-components");
var MenuItem_1 = require("../SideMenu/MenuItem");
var styled_elements_1 = require("../SideMenu/styled.elements");
var SearchInput = styled_components_1.default.input(templateObject_1 || (templateObject_1 = __makeTemplateObject(["\n  width: calc(100% - ", "px);\n  box-sizing: border-box;\n  margin: 0 ", "px;\n  padding: 5px 0 5px ", "px;\n  border: 0;\n  border-bottom: 1px solid #e1e1e1;\n  font-weight: bold;\n  font-size: 13px;\n  color: ", ";\n  background-color: transparent;\n  outline: none;\n"], ["\n  width: calc(100% - ", "px);\n  box-sizing: border-box;\n  margin: 0 ", "px;\n  padding: 5px 0 5px ", "px;\n  border: 0;\n  border-bottom: 1px solid #e1e1e1;\n  font-weight: bold;\n  font-size: 13px;\n  color: ", ";\n  background-color: transparent;\n  outline: none;\n"])), function (props) { return props.theme.spacingUnit * 2; }, function (props) { return props.theme.spacingUnit; }, function (props) { return props.theme.spacingUnit; }, function (props) { return props.theme.colors.text; });
var SearchIcon = styled_components_1.default(function (props) { return (React.createElement("svg", { className: props.className, version: "1.1", viewBox: "0 0 1000 1000", x: "0px", xmlns: "http://www.w3.org/2000/svg", y: "0px" },
    React.createElement("path", { d: "M968.2,849.4L667.3,549c83.9-136.5,66.7-317.4-51.7-435.6C477.1-25,252.5-25,113.9,113.4c-138.5,138.3-138.5,362.6,0,501C219.2,730.1,413.2,743,547.6,666.5l301.9,301.4c43.6,43.6,76.9,14.9,104.2-12.4C981,928.3,1011.8,893,968.2,849.4z M524.5,522c-88.9,88.7-233,88.7-321.8,0c-88.9-88.7-88.9-232.6,0-321.3c88.9-88.7,233-88.7,321.8,0C613.4,289.4,613.4,433.3,524.5,522z" }))); })(templateObject_2 || (templateObject_2 = __makeTemplateObject(["\n  position: absolute;\n  left: ", "px;\n  height: 1.8em;\n  width: 0.9em;\n\n  path {\n    fill: ", ";\n  }\n"], ["\n  position: absolute;\n  left: ", "px;\n  height: 1.8em;\n  width: 0.9em;\n\n  path {\n    fill: ", ";\n  }\n"])), function (props) { return props.theme.spacingUnit; }, function (props) { return props.theme.colors.text; });
var SearchResultsBox = styled_components_1.default.div(templateObject_3 || (templateObject_3 = __makeTemplateObject(["\n  padding: ", "px 0;\n  background-color: #ededed;\n  min-height: 150px;\n  max-height: 250px;\n  border-top: 1px solid #e1e1e1;\n  border-bottom: 1px solid #e1e1e1;\n  margin-top: 10px;\n  line-height: 1.4;\n  font-size: 0.9em;\n  overflow: auto;\n\n  ", " {\n    padding-top: 6px;\n    padding-bottom: 6px;\n\n    &:hover {\n      background-color: #e1e1e1;\n    }\n\n    > svg {\n      display: none;\n    }\n  }\n"], ["\n  padding: ", "px 0;\n  background-color: #ededed;\n  min-height: 150px;\n  max-height: 250px;\n  border-top: 1px solid #e1e1e1;\n  border-bottom: 1px solid #e1e1e1;\n  margin-top: 10px;\n  line-height: 1.4;\n  font-size: 0.9em;\n  overflow: auto;\n\n  ", " {\n    padding-top: 6px;\n    padding-bottom: 6px;\n\n    &:hover {\n      background-color: #e1e1e1;\n    }\n\n    > svg {\n      display: none;\n    }\n  }\n"])), function (props) { return props.theme.spacingUnit / 4; }, styled_elements_1.MenuItemLabel);
var SearchBox = /** @class */ (function (_super) {
    __extends(SearchBox, _super);
    function SearchBox(props) {
        var _this = _super.call(this, props) || this;
        _this.search = function (event) {
            var q = event.target.value;
            if (q.length < 3) {
                _this.setState({
                    term: q,
                    results: [],
                });
                return;
            }
            _this.setState({
                term: q,
            });
            _this.props.search.search(event.target.value).then(function (res) {
                _this.setState({
                    results: res,
                });
            });
        };
        _this.clearIfEsq = function (event) {
            if (event && event.keyCode === 27) {
                // escape
                _this.setState({ term: '', results: [] });
            }
        };
        _this.state = {
            results: [],
            term: '',
        };
        return _this;
    }
    SearchBox.prototype.render = function () {
        var _this = this;
        var items = this.state.results.map(function (res) { return _this.props.getItemById(res.id); });
        items.sort(function (a, b) { return (a.depth > b.depth ? 1 : a.depth < b.depth ? -1 : 0); });
        return (React.createElement("div", null,
            React.createElement(SearchIcon, null),
            React.createElement(SearchInput, { value: this.state.term, onKeyDown: this.clearIfEsq, placeholder: "Search...", type: "text", onChange: this.search }),
            items.length > 0 && (React.createElement(SearchResultsBox, null, items.map(function (item) { return (React.createElement(MenuItem_1.MenuItem, { item: item, onActivate: _this.props.onActivate, withoutChildren: true, key: item.id })); })))));
    };
    return SearchBox;
}(React.PureComponent));
exports.SearchBox = SearchBox;
var templateObject_1, templateObject_2, templateObject_3;
//# sourceMappingURL=SearchBox.js.map